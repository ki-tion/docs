(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{311:function(t,a,s){"use strict";s.r(a);var e=s(10),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" "),a("center",[t._v("Nginx")])],1),t._v(" "),a("h2",{attrs:{id:"中间件架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中间件架构"}},[t._v("#")]),t._v(" 中间件架构")]),t._v(" "),a("h3",{attrs:{id:"中间件技术可以带来什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#中间件技术可以带来什么"}},[t._v("#")]),t._v(" 中间件技术可以带来什么")]),t._v(" "),a("ul",[a("li",[t._v("间件是在操作系统功能范围外为应用提供服务的多用途软件。任何位于内核和用户应用之间的软件都可以是中间件。中间件不提供传统应用的功能，而是将软件与其他软件衔接。由于中间件能够让数据从一个应用流动到另一个中，因此把它比作输水管最为贴切。")])]),t._v(" "),a("h3",{attrs:{id:"nginx简述"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx简述"}},[t._v("#")]),t._v(" Nginx简述")]),t._v(" "),a("ul",[a("li",[t._v("Nginx是一个高性能的且开源、可靠的HTTP中间件、代理服务")])]),t._v(" "),a("h3",{attrs:{id:"常见的http服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见的http服务"}},[t._v("#")]),t._v(" 常见的HTTP服务")]),t._v(" "),a("ul",[a("li",[t._v("HTTP\n"),a("ul",[a("li",[t._v("-Apache 基金会")])])]),t._v(" "),a("li",[t._v("IIS\n"),a("ul",[a("li",[t._v("微软")])])]),t._v(" "),a("li",[t._v("GWS\n"),a("ul",[a("li",[t._v("-Google")])])])]),t._v(" "),a("h3",{attrs:{id:"nginx的优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的优点"}},[t._v("#")]),t._v(" Nginx的优点")]),t._v(" "),a("h3",{attrs:{id:"什么是io复用-io多路复用epoll"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是io复用-io多路复用epoll"}},[t._v("#")]),t._v(" 什么是IO复用(IO多路复用epoll)")]),t._v(" "),a("ul",[a("li",[a("p",[a("code",[t._v("请求、IO流")]),t._v(" -> socket -> 多线程")])]),t._v(" "),a("li",[a("p",[t._v("具体")]),t._v(" "),a("ul",[a("li",[t._v("多个描述符的I/O操作都能够在一个线程中内并发交替的顺序完成，这就叫I/O多路复用，这里的复用是指的复用同一个线程")])])])]),t._v(" "),a("h3",{attrs:{id:"轻量级"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#轻量级"}},[t._v("#")]),t._v(" 轻量级")]),t._v(" "),a("ul",[a("li",[t._v("通常说的轻量级的标准\n"),a("ul",[a("li",[t._v("功能模式少")]),t._v(" "),a("li",[t._v("代码模块少")])])])]),t._v(" "),a("h3",{attrs:{id:"cpu亲和-affinity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cpu亲和-affinity"}},[t._v("#")]),t._v(" CPU亲和(affinity)")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("老牌服务器")]),t._v(" "),a("ul",[a("li",[t._v("Apache\n"),a("ul",[a("li",[t._v("老牌的服务器软件")]),t._v(" "),a("li",[t._v("功能多，并且配置丰富、稳定")])])]),t._v(" "),a("li",[t._v("Nginx\n"),a("ul",[a("li",[t._v("解决并发问题")]),t._v(" "),a("li",[t._v("简单小巧")]),t._v(" "),a("li",[t._v("并发量高")])])])])]),t._v(" "),a("li",[a("p",[t._v("Nginx主要用途")]),t._v(" "),a("ul",[a("li",[t._v("Web服务器")]),t._v(" "),a("li",[t._v("代理服务器")]),t._v(" "),a("li",[t._v("邮箱服务器")]),t._v(" "),a("li",[t._v("immp")])])]),t._v(" "),a("li",[a("p",[t._v("数据库")]),t._v(" "),a("ul",[a("li",[t._v("mysql")]),t._v(" "),a("li",[t._v("SQlserver")]),t._v(" "),a("li",[t._v("oracle")]),t._v(" "),a("li",[t._v("DB2")]),t._v(" "),a("li",[t._v("mariaDB")])])]),t._v(" "),a("li",[a("p",[t._v("NOSQL")]),t._v(" "),a("ul",[a("li",[t._v("memcached")]),t._v(" "),a("li",[t._v("redis")]),t._v(" "),a("li",[t._v("mongdb")])])])]),t._v(" "),a("h4",{attrs:{id:"负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡"}},[t._v("#")]),t._v(" 负载均衡")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("负载均衡服务器，分发请求到不同的服务器，使流量平均分配")])]),t._v(" "),a("li",[a("p",[t._v("服务器死机都成为宕**(dang)**机")])]),t._v(" "),a("li",[a("p",[t._v("负载级别")]),t._v(" "),a("ul",[a("li",[t._v("软件级别\n"),a("ul",[a("li",[t._v("性能好")]),t._v(" "),a("li",[t._v("价格高")])])]),t._v(" "),a("li",[t._v("软件级别\n"),a("ul",[a("li",[t._v("性价比高")])])]),t._v(" "),a("li",[t._v("lvs\n"),a("ul",[a("li",[t._v("linux下分发软件")])])]),t._v(" "),a("li",[t._v("nginx\n"),a("ul",[a("li",[t._v("upstream功能分发")])])])])])]),t._v(" "),a("h3",{attrs:{id:"资源服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源服务器"}},[t._v("#")]),t._v(" 资源服务器")]),t._v(" "),a("ul",[a("li",[t._v("资源服务器储存静态资源、css、js、图片、视频")]),t._v(" "),a("li",[t._v("一般此服务器会有硬盘（SSD），读写速度快")]),t._v(" "),a("li",[t._v("带宽高")])]),t._v(" "),a("h2",{attrs:{id:"代理服务器架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理服务器架构"}},[t._v("#")]),t._v(" 代理服务器架构")]),t._v(" "),a("h3",{attrs:{id:"为什么需要反向代理服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要反向代理服务器"}},[t._v("#")]),t._v(" 为什么需要反向代理服务器")]),t._v(" "),a("ul",[a("li",[t._v("由于浏览器安全策略限制，跨域请求都不能够访问")]),t._v(" "),a("li",[t._v("a ->× b")]),t._v(" "),a("li",[t._v("代理服务器\n"),a("ul",[a("li",[t._v("a -> c -> b")])])])]),t._v(" "),a("h3",{attrs:{id:"正向代理和反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正向代理和反向代理"}},[t._v("#")]),t._v(" 正向代理和反向代理")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("服务器 -> 外网服务器 -> 个人")])]),t._v(" "),a("li",[a("p",[t._v("代理其实就是叫别人去帮你做你不能做的事情")])]),t._v(" "),a("li",[a("p",[t._v("代理服务器具有代理到对应服务器的功能，有具有缓存的功能，、")])])]),t._v(" "),a("h3",{attrs:{id:"代理服务器的种类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理服务器的种类"}},[t._v("#")]),t._v(" 代理服务器的种类")]),t._v(" "),a("ul",[a("li",[t._v("nginx")]),t._v(" "),a("li",[t._v("squid")]),t._v(" "),a("li",[t._v("varnish")])]),t._v(" "),a("h3",{attrs:{id:"nginx的优点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的优点-2"}},[t._v("#")]),t._v(" Nginx的优点")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("热部署")]),t._v(" "),a("ul",[a("li",[t._v("nginx在修改配置文件之后，不需要重启，重载操作")])])]),t._v(" "),a("li",[a("p",[t._v("可并发可连接")]),t._v(" "),a("ul",[a("li",[t._v("相同配置的服务器，nginx和apache能连接的更多")])])]),t._v(" "),a("li",[a("p",[t._v("低的内存消耗")]),t._v(" "),a("ul",[a("li",[t._v("相同的服务器，nginx比apache低的消耗")])])]),t._v(" "),a("li",[a("p",[t._v("处理响应请求很快")]),t._v(" "),a("ul",[a("li",[t._v("nginx处理静态方面比其他的一些服务器速度更快")])])])]),t._v(" "),a("h3",{attrs:{id:"nginx和apache"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx和apache"}},[t._v("#")]),t._v(" Nginx和apache")]),t._v(" "),a("ul",[a("li",[t._v("apache在安全和稳定性比nginx好些")]),t._v(" "),a("li",[t._v("lnmpa架构")]),t._v(" "),a("li",[t._v("ianmN架构")]),t._v(" "),a("li",[t._v("其实都是借助各自的优点")])]),t._v(" "),a("h2",{attrs:{id:"nginx的安装和使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的安装和使用"}},[t._v("#")]),t._v(" Nginx的安装和使用")]),t._v(" "),a("h3",{attrs:{id:"环境准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[t._v("#")]),t._v(" 环境准备")]),t._v(" "),a("ul",[a("li",[t._v("yum可用")]),t._v(" "),a("li",[t._v("确认关闭iptables")]),t._v(" "),a("li",[t._v("确认停用selinux")])]),t._v(" "),a("h3",{attrs:{id:"运行环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行环境"}},[t._v("#")]),t._v(" 运行环境")]),t._v(" "),a("ul",[a("li",[t._v("安装gcc以及其他的一些软件")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-y")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" gcc gcc-c++ autoconf pcre pcre-devel "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("make")]),t._v(" automake \n")])])]),a("h3",{attrs:{id:"版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#版本"}},[t._v("#")]),t._v(" 版本")]),t._v(" "),a("ul",[a("li",[t._v("Nginx分为开发版（mainline）和正式版（stable）以及以往的历史版本（legacy）")]),t._v(" "),a("li",[t._v("版本中的pgp是代码效验的意思，其为验证安装是否为原版的链接，防止使用被二次修改的Nginx安装包")])]),t._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("ul",[a("li",[t._v("你可以使用离线安装，也可以选择安装使用 yum安装")])]),t._v(" "),a("h4",{attrs:{id:"在线安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在线安装"}},[t._v("#")]),t._v(" 在线安装")]),t._v(" "),a("ul",[a("li",[t._v("点击官网下面的 Pre-Built Packages下的链接")]),t._v(" "),a("li",[t._v("选择对应的系统版本，如RHEL/CentOS")]),t._v(" "),a("li",[t._v("复制对应的yum源，如")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("nginx-stable"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nname=nginx stable repo\nbaseurl=http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//nginx.org/packages/centos/$releasever/$basearch/")]),t._v("\ngpgcheck="),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\nenabled="),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\ngpgkey=https"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//nginx.org/keys/nginx_signing.key")]),t._v("\n")])])]),a("ul",[a("li",[t._v("编辑保存")]),t._v(" "),a("li",[t._v("查找对应的Nginx安装包")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查找对应nginx版本")]),t._v("\nyum list "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 直接安装nginx 版本")]),t._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum 测试安装")]),t._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# yum 测试是否成功")]),t._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-V")]),t._v("\n")])])]),a("h3",{attrs:{id:"基本参数使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本参数使用"}},[t._v("#")]),t._v(" 基本参数使用")]),t._v(" "),a("h4",{attrs:{id:"基本安装目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本安装目录"}},[t._v("#")]),t._v(" 基本安装目录")]),t._v(" "),a("ul",[a("li",[t._v("安装目录讲解")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看nginx包的安装目录")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-ql")]),t._v(" nginx\n")])])]),a("ul",[a("li",[t._v("具体目录")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 该路径配置文件，nginx日志轮转，用于logrotate服务的日志切割")]),t._v("\n/etc/logrotate.d/nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 目录、配置文件，Nginx主配置文件")]),t._v("\n/etc/nginx\n/etc/nginx/nginx/conf\n/etc/nginx/conf.d\n/etc/nginx/conf.d/default.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件、设置http协议的content-Type与扩展名对应关系")]),t._v("\n/etc/nginx/mime.types\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件，用于配置文件出系统守护进程管理器管理方式")]),t._v("\n/usr/lib/systemd/system/nginx-debug.service\n/usr/lib/systemd/system/nginx.service\n/etc/sysconfig/nginx\n/etc/sysconfig/nginx-debug\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 命令，nginx服务的启用管理的终端命令")]),t._v("\n/usr/sbin/nginx\n/usr/sbin/nginx-debug\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件、目录管理，nginx的手册和帮助文件")]),t._v("\n/usr/share/doc/nginx-"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$version")]),t._v("\n/usr/share/doc/nginx-"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$version")]),t._v("/COPYRIGHT\n/usr/share/doc/man/man8/nginx.8.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx的缓存目录")]),t._v("\n/usr/cache/nginx/\n")])])]),a("h4",{attrs:{id:"安装编译参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装编译参数"}},[t._v("#")]),t._v(" 安装编译参数")]),t._v(" "),a("ul",[a("li",[t._v("命令")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 得到nginx安装的详细配置文件地址")]),t._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-V")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设定Nginx进程启用的用户和组用户 ")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--group")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置额外的参数将被添加到cflags中")]),t._v("\n--with-cc-opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("parameters\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装编译参数，设置附加的参数，链接系统库")]),t._v("\n--width-ld-opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("parameters\n")])])]),a("h4",{attrs:{id:"nginx-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf"}},[t._v("#")]),t._v(" Nginx.conf")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("注意编译nginx中出现中断会产生一个临时空文件，nginx.conf.swp文件，导致再次编译nginx.conf会编译nginx.conf.swp")]),t._v(" "),a("ul",[a("li",[t._v("可以删除该文件")]),t._v(" "),a("li",[t._v("也可以继续编译该文件，并保存为最终的nginx.conf文件")])])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 在nginx中的conf.d文件夹中的conf配置也会被读取到配置中")]),t._v("\ninclude /etc/nginx/conf.d/*.conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("ul",[a("li",[t._v("在nginx.d文件夹中有一个default.conf文件，是一个默认conf文件")])]),t._v(" "),a("h4",{attrs:{id:"nginx-conf配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-conf配置"}},[t._v("#")]),t._v(" Nginx.conf配置")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("配置点")]),t._v(" "),a("ul",[a("li",[t._v("user\n"),a("ul",[a("li",[t._v("设置nginx服务的系统的系统使用用户")])])]),t._v(" "),a("li",[t._v("worker_processes\n"),a("ul",[a("li",[t._v("工作进程数，一般和CUP数量一致就可以")])])]),t._v(" "),a("li",[t._v("error_log\n"),a("ul",[a("li",[t._v("nginx的错误日志")])])]),t._v(" "),a("li",[t._v("pid\n"),a("ul",[a("li",[t._v("nginx服务启动时候pid")])])])])]),t._v(" "),a("li",[a("p",[t._v("event")]),t._v(" "),a("ul",[a("li",[t._v("worker_connetcions\n"),a("ul",[a("li",[t._v("每个进程允许的最大连接数")])])]),t._v(" "),a("li",[t._v("use\n"),a("ul",[a("li",[t._v("工作进程数")])])])])]),t._v(" "),a("li",[a("p",[t._v("Nginx是由C语言编写的")])])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 设置nginx服务的系统用户")]),t._v("\nuser  nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 工作进程数")]),t._v("\nworker_processes  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 错误日志输入")]),t._v("\nerror_log  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("error"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log warn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// pid")]),t._v("\npid        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("run"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 每个进程连接数")]),t._v("\nevents "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    worker_connections  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nhttp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// mime类型")]),t._v("\n    include       "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("types"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认类型配置")]),t._v("\n    default_type  application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("octet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 日志格式")]),t._v("\n    log_format  main  '$remote_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" $remote_user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$time_local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$request"')]),t._v(" '\n                      '$status $body_bytes_sent "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$http_referer"')]),t._v(" '\n                      '"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$http_user_agent"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$http_x_forwarded_for"')]),t._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 成功运行日志")]),t._v("\n    access_log  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    sendfile        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("tcp")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_nopush     on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n\n    keepalive_timeout  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n\n    include "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("etc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*.conf;\n}\n")])])])]),a("h4",{attrs:{id:"default-conf"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#default-conf"}},[t._v("#")]),t._v(" default.conf")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("server配置")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("listen")]),t._v(" "),a("ul",[a("li",[t._v("监听端口")])])]),t._v(" "),a("li",[a("p",[t._v("server_name")]),t._v(" "),a("ul",[a("li",[t._v("服务器名称")])])]),t._v(" "),a("li",[a("p",[t._v("location")]),t._v(" "),a("ul",[a("li",[t._v("默认服务器目录")])])]),t._v(" "),a("li",[a("p",[t._v("error_page")]),t._v(" "),a("ul",[a("li",[t._v("500")]),t._v(" "),a("li",[t._v("502")]),t._v(" "),a("li",[t._v("503")]),t._v(" "),a("li",[t._v("504")])])]),t._v(" "),a("li",[a("p",[t._v("location")]),t._v(" "),a("ul",[a("li",[t._v("错误码对应html")])])])])])]),t._v(" "),a("h4",{attrs:{id:"配置分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置分析"}},[t._v("#")]),t._v(" 配置分析")]),t._v(" "),a("ul",[a("li",[t._v("配置分析")])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    listen       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    server_name  localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("charset")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("koi8"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("access")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_log  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("var"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log  main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// root根目录")]),t._v("\n        root   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 默认访问index.html")]),t._v("\n        index  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_page  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404")]),t._v("              "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("404.")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("redirect")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("server error pages to the "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" page "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_page   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        root   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("usr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("share"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("proxy")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("the PHP scripts to Apache listening on "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")])])]),t._v("\n    #\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" \\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")])])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_pass   http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")])]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//127.0.0.1;")])]),t._v("\n    #"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("the PHP scripts to FastCGI server listening on "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")])])]),t._v("\n    #\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" \\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")])])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("root")]),t._v("           "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("fastcgi")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_pass   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("9000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("fastcgi")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_index  index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("fastcgi")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_param  SCRIPT_FILENAME  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("scripts$fastcgi_script_name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("include")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("fastcgi_params"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n    #"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("deny")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("access to "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htaccess files"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" Apache's document root")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("concurs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("with nginx's one")])]),t._v("\n    #\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ht "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")])])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("deny")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n    #"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h4",{attrs:{id:"nginx的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的使用"}},[t._v("#")]),t._v(" Nginx的使用")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启用nginx，启用和重启之前必须先停止之前的服务")]),t._v("\nsystemctl start nginx.service\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启")]),t._v("\nsystemctl restart nginx.service\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查找nginx配置")]),t._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者使用 -t 检查某个配置文件")]),t._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" filename\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查找端口")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("netstat")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-tnlp")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查找nginx服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-aux")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 杀死nginx服务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pkill")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-9")]),t._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用curl进行浏览器访问,curl是linux的browser")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-v")]),t._v(" /url\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭某个端口的防火墙")]),t._v("\nfirewall-cmd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--zone")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("/tcp "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--permanent")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# curl需要安装，可以使用 yum install安装")]),t._v("\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" crul\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重载nginx")]),t._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" nginx.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重启服务")]),t._v("\nsystemtcl\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重载nginx服务 ")]),t._v("\nsystemctl reload nginx\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 隐藏文件夹")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v(" fileName .filenName\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 隐藏文件不能通过 ls 查找到, 需要加上 -a 修饰符")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-a")]),t._v("\n")])])]),a("ul",[a("li",[t._v("当报错，nginx: [error] invalid PID number时，需要")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要先执行")]),t._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" /etc/nginx/nginx.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx.conf文件的路径可以从nginx -t的返回中找到。")]),t._v("\nnginx "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-s")]),t._v(" reload\n")])])]),a("h4",{attrs:{id:"nginx基本配置语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx基本配置语法"}},[t._v("#")]),t._v(" Nginx基本配置语法")]),t._v(" "),a("ul",[a("li",[t._v("配置nginx的log的记录HEAD头信息")])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果想在日志中记录访问的响应头，可以在nginx.conf的log_format中添加，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 格式为注意横杠需要转换为下划线，main主题内容，增加'$http_user_agent'内容")]),t._v("\nlog_format main "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("'$http_user_agent'")]),t._v(" '$reomte_addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" $reomte_user "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("$time_local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"request"')]),t._v(" '\n")])])]),a("ul",[a("li",[t._v("修改完nginx之后需要重载")])]),t._v(" "),a("h4",{attrs:{id:"nginx的变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的变量"}},[t._v("#")]),t._v(" Nginx的变量")]),t._v(" "),a("ul",[a("li",[t._v("HTTP请求变量 - arg PARAMETER、http_HEADER 、sent_http_HEADER")]),t._v(" "),a("li",[t._v("内置变量 - Nginx内置")])]),t._v(" "),a("h3",{attrs:{id:"nginx模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx模块"}},[t._v("#")]),t._v(" Nginx模块")]),t._v(" "),a("h4",{attrs:{id:"http-stub-status-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-stub-status-module"}},[t._v("#")]),t._v(" "),a("strong",[t._v("http_stub_status_module")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("Syntax stub_status")])]),t._v(" "),a("li",[a("p",[t._v("Default")]),t._v(" "),a("ul",[a("li",[a("ul",[a("li")])])])]),t._v(" "),a("li",[a("p",[t._v("Contetx")]),t._v(" "),a("ul",[a("li",[t._v("server")]),t._v(" "),a("li",[t._v("location")])])]),t._v(" "),a("li",[a("p",[t._v("配置")])])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 在default的server配置中，新增配置location")]),t._v("\nlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mystatus "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    sub_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("访问，在nginx的访问端口加入status的名称")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 如 mystatus 就是 8089/mystatus")]),t._v("\n")])])]),a("h3",{attrs:{id:"nginx的默认模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的默认模块"}},[t._v("#")]),t._v(" Nginx的默认模块")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("默认模块讲解")])]),t._v(" "),a("li",[a("p",[t._v("编译选项 - 作用")])])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("with"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("random_indexmodule \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 目录中选择一个随机主页")]),t._v("\n")])])]),a("h4",{attrs:{id:"配置语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置语法"}},[t._v("#")]),t._v(" 配置语法")]),t._v(" "),a("ul",[a("li",[t._v("random_index_module\n"),a("ul",[a("li",[t._v("on")]),t._v(" "),a("li",[t._v("off")])])]),t._v(" "),a("li",[t._v("Default\n"),a("ul",[a("li",[t._v("random_index\n"),a("ul",[a("li",[t._v("off")])])])])]),t._v(" "),a("li",[t._v("Context\n"),a("ul",[a("li",[t._v("location")])])])]),t._v(" "),a("h4",{attrs:{id:"example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example"}},[t._v("#")]),t._v(" example")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("location "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    random_index on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("index")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"with-http-sub-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#with-http-sub-module"}},[t._v("#")]),t._v(" with-http-sub-module")]),t._v(" "),a("ul",[a("li",[t._v("with-http-sub-module的http内容替换")])]),t._v(" "),a("h4",{attrs:{id:"书写格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#书写格式"}},[t._v("#")]),t._v(" 书写格式")]),t._v(" "),a("ul",[a("li",[t._v("syntax:\n"),a("ul",[a("li",[t._v("sub_filter")]),t._v(" "),a("li",[t._v("string")]),t._v(" "),a("li",[t._v("replaceement")])])]),t._v(" "),a("li",[t._v("default")]),t._v(" "),a("li",[t._v("context\n"),a("ul",[a("li",[t._v("http")]),t._v(" "),a("li",[t._v("server")]),t._v(" "),a("li",[t._v("location")])])])]),t._v(" "),a("h3",{attrs:{id:"http-sub-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-sub-module"}},[t._v("#")]),t._v(" http-sub-module")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("syntax")]),t._v(" "),a("ul",[a("li",[t._v("sub_filter_last_modfiled no/off")]),t._v(" "),a("li",[t._v("default:\n"),a("ul",[a("li",[t._v("sub_filter_last_modified\n"),a("ul",[a("li",[t._v("off")])])])])]),t._v(" "),a("li",[t._v("contetx")]),t._v(" "),a("li",[t._v("location")]),t._v(" "),a("li",[t._v("server")]),t._v(" "),a("li",[t._v("location")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Example")])])])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("server "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        sub_filter "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("'被替换的内容'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("'替换的内容'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"nginx的请求限制配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的请求限制配置"}},[t._v("#")]),t._v(" Nginx的请求限制配置")]),t._v(" "),a("ul",[a("li",[t._v("连接请求限制\n"),a("ul",[a("li",[t._v("limit_conn_module")])])]),t._v(" "),a("li",[t._v("请求频率限制\n"),a("ul",[a("li",[t._v("limit_req_module")])])])]),t._v(" "),a("h4",{attrs:{id:"http限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http限制"}},[t._v("#")]),t._v(" HTTP限制")]),t._v(" "),a("ul",[a("li",[t._v("HTTP协议版本")]),t._v(" "),a("li",[t._v("连接关系\n"),a("ul",[a("li",[t._v("HTTP1.0\n"),a("ul",[a("li",[a("strong",[t._v("TCP不能复用")])])])]),t._v(" "),a("li",[t._v("HTTP1.1\n"),a("ul",[a("li",[t._v("顺序复用")])])]),t._v(" "),a("li",[t._v("HTTP2.0\n"),a("ul",[a("li",[t._v("多路复用TCP")])])])])]),t._v(" "),a("li",[t._v("HTTP请求建立在一次TCP的请求基础之上")]),t._v(" "),a("li",[t._v("一次TCP请求至少产生一次HTTP请求")])]),t._v(" "),a("h4",{attrs:{id:"连接限制语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#连接限制语法"}},[t._v("#")]),t._v(" 连接限制语法")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("只能调用了limit_conn_zone key zone-name.size才能配置下一项目")])]),t._v(" "),a("li",[a("p",[t._v("syntax")]),t._v(" "),a("ul",[a("li",[t._v("limit_conn_zone key zone-name.size\n"),a("ul",[a("li",[t._v("key为限制连接条件，例如 ip等")]),t._v(" "),a("li",[t._v("size为限制大小")]),t._v(" "),a("li",[t._v("zone 为限制的命名空间")])])]),t._v(" "),a("li",[t._v("default\n"),a("ul",[a("li",[a("ul",[a("li")])])])]),t._v(" "),a("li",[t._v("Context\n"),a("ul",[a("li",[t._v("http")])])])])]),t._v(" "),a("li",[a("p",[t._v("Syntax")]),t._v(" "),a("ul",[a("li",[t._v("该语法限制在规定的时间内的并发")]),t._v(" "),a("li",[t._v("limit_conn zone number;")]),t._v(" "),a("li",[t._v("Default: -")]),t._v(" "),a("li",[t._v("Context\n"),a("ul",[a("li",[t._v("http")]),t._v(" "),a("li",[t._v("server")]),t._v(" "),a("li",[t._v("location")])])])])])]),t._v(" "),a("h4",{attrs:{id:"example-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-2"}},[t._v("#")]),t._v(" Example")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一般我们都会把限制语句放在前面，防止后面的配置执行，拦截超出请求")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 该限制策略为 以 adrr(即用户ip)为限制，空间为conn，；连接限制为1")]),t._v("\nlimit_conn_zone $binary_remote_addr zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("conn"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求限制，以请求addr（i策略）空间为 req_zone，每一秒为1个请求，rate为规定时间的请求限制；")]),t._v("\nlimit_req_zone $binary_remote_addr zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("req_zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("m rate"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("r"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("limit")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_req zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("req_zone burst"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" nodelay"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("limit")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_req zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("req_zone burst"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("limit")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_req zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("req_zone"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n")])])]),a("ul",[a("li",[a("strong",[t._v("使用linux命令进行请求测试")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 一共50个请求数，每秒20个，")]),t._v("\nab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" url/filename\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 例如 ")]),t._v("\nab "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-n")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" http://192.168.241.133:8089/index.html\n")])])]),a("h3",{attrs:{id:"nginx的访问控制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的访问控制"}},[t._v("#")]),t._v(" Nginx的访问控制")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 基于IP的访问控制")]),t._v("\nhttp_access_module\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 基于用户的信任控制")]),t._v("\nhttp_auth_basic_module\n")])])]),a("ul",[a("li",[a("p",[t._v("http_access_module")]),t._v(" "),a("ul",[a("li",[t._v("syntax\n"),a("ul",[a("li",[t._v("allow address")]),t._v(" "),a("li",[t._v("CIDR")]),t._v(" "),a("li",[t._v("unix")]),t._v(" "),a("li",[t._v("all")])])]),t._v(" "),a("li",[t._v("default")]),t._v(" "),a("li",[t._v("Context\n"),a("ul",[a("li",[t._v("http")]),t._v(" "),a("li",[t._v("server")]),t._v(" "),a("li",[t._v("location")]),t._v(" "),a("li",[t._v("limit_except")])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Example")])])])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 处理访问 admin.html配置")]),t._v("\nlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根目录")]),t._v("\n    root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拒绝当前的IP")]),t._v("\n    deny "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("182.97")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".52")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".254")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 然后允许所有的ip")]),t._v("\n    allow all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    index index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 然后使用限制ip访问之后，你会发现是forbidden 403")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你设置可以换种方式")]),t._v("\nlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("media"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("code\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 允许当前的ip；")]),t._v("\n    allow "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("182.97")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".52")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".254")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拒绝所有的ip")]),t._v("\n    deny all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    index index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html index"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("p",[t._v("http_access_module的局限性")]),t._v(" "),a("ul",[a("li",[t._v("http_access_module只能作用于未使用代理的服务器，针对共有IP等、代理服务器等无法限制")])])]),t._v(" "),a("li",[a("p",[t._v("弥补方案")]),t._v(" "),a("ul",[a("li",[t._v("http_x_forwarded_for")])])]),t._v(" "),a("li",[a("p",[t._v("http_x_forwarded_for和http_access_module的对比")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("ip1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("prox")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("remote_addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("IP1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" remote_addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Ip2\nip1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("prox")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x_forwarde_for"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("IP1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" x_forwarde_for"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("Ip1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("IP2\n")])])])]),t._v(" "),a("li",[a("p",[t._v("解决http_access_module的局限")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("采用别的HTTP头信息进行访问控制")])]),t._v(" "),a("li",[a("p",[t._v("结合geo")])]),t._v(" "),a("li",[a("p",[t._v("通过HTTP自定义变量传递")])])])])]),t._v(" "),a("h3",{attrs:{id:"http-auth-basic-module"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-auth-basic-module"}},[t._v("#")]),t._v(" http_auth_basic_module")]),t._v(" "),a("ul",[a("li",[t._v("auth_basic\n"),a("ul",[a("li",[t._v("auth_basic\n"),a("ul",[a("li",[t._v("string")]),t._v(" "),a("li",[t._v("of")])])]),t._v(" "),a("li",[t._v("default\n"),a("ul",[a("li",[t._v("auto_basic -> off")])])]),t._v(" "),a("li",[t._v("Context\n"),a("ul",[a("li",[t._v("http")]),t._v(" "),a("li",[t._v("server")]),t._v(" "),a("li",[t._v("location")]),t._v(" "),a("li",[t._v("limit_except")])])])])]),t._v(" "),a("li",[t._v("auth_basic_user_file -> file\n"),a("ul",[a("li",[t._v("default\n"),a("ul",[a("li",[a("ul",[a("li")])])])]),t._v(" "),a("li",[t._v("Context\n"),a("ul",[a("li",[t._v("http")]),t._v(" "),a("li",[t._v("server")]),t._v(" "),a("li",[t._v("location")]),t._v(" "),a("li",[t._v("limit_except")])])])])]),t._v(" "),a("li",[a("code",[t._v("<https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html>")])])]),t._v(" "),a("h4",{attrs:{id:"example-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-3"}},[t._v("#")]),t._v(" Example")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成密码文件,文件存放在上一级文件下")]),t._v("\n【nginx】htpasswd "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" path jeson\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件实例")]),t._v("\nlocation ~ ^/admin.html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    root /opt/app/code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 提示输入密码")]),t._v("\n    auth_basic "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Auth access test! input your password!"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 密码文件地址")]),t._v("\n    auth_basic_user_file /etc/nginx/pass_conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# index配置")]),t._v("\n    index index.html index.htm\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("p",[t._v("http_auth_basic_module的局限性")]),t._v(" "),a("ul",[a("li",[t._v("用户信息依赖文件方式")]),t._v(" "),a("li",[t._v("操作管理机械性，效率低下")])])]),t._v(" "),a("li",[a("p",[t._v("解决方案")]),t._v(" "),a("ul",[a("li",[t._v("Nginx结合LUA实现高效验证")]),t._v(" "),a("li",[t._v("Nginx和LDAP打通，利用nginx-auth-ldap模块")])])])]),t._v(" "),a("h2",{attrs:{id:"nginx的web静态资源服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的web静态资源服务"}},[t._v("#")]),t._v(" Nginx的Web静态资源服务")]),t._v(" "),a("h3",{attrs:{id:"静态资源架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态资源架构"}},[t._v("#")]),t._v(" 静态资源架构")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("客户=>REQ (jpeg，png)  -> Nginx -> 静态资源服务处理")])]),t._v(" "),a("li",[a("p",[t._v("非服务器动态运行生成的文件")])]),t._v(" "),a("li",[a("p",[t._v("浏览器端渲染")]),t._v(" "),a("ul",[a("li",[t._v("HTML")]),t._v(" "),a("li",[t._v("CSS")]),t._v(" "),a("li",[t._v("JS")])])]),t._v(" "),a("li",[a("p",[t._v("图片")])]),t._v(" "),a("li",[a("p",[t._v("视频资源")])])]),t._v(" "),a("h3",{attrs:{id:"配置语法-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置语法-2"}},[t._v("#")]),t._v(" 配置语法")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("文件读取")]),t._v(" "),a("ul",[a("li",[t._v("Syntax")])]),t._v(" "),a("blockquote",[a("p",[t._v("syntax off || no")]),t._v(" "),a("p",[t._v("Default: sendfile off;")]),t._v(" "),a("p",[t._v("Context: http, server,location,if in,location")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("引读")]),t._v(" "),a("p",[t._v("-with-file-aio异步文件读取")])])])])]),t._v(" "),a("li",[a("p",[t._v("配置语法-tcp_nopush")]),t._v(" "),a("ul",[a("li",[t._v("Syntax")])]),t._v(" "),a("blockquote",[a("p",[t._v("tcp_nopush no | off")]),t._v(" "),a("p",[t._v("default:  tcp_nopush off;")]),t._v(" "),a("ul",[a("li",[t._v("作用： sendfile开启的情况，提高网络包的传输效率")])])])]),t._v(" "),a("li",[a("p",[t._v("tcp_npdelay")]),t._v(" "),a("blockquote",[a("p",[t._v("tcp_npdelay no | off")]),t._v(" "),a("p",[t._v("default:  tcp_npdelay off;")]),t._v(" "),a("ul",[a("li",[t._v("作用： keepalive（长连接）连接下，提高网络包的传输实时性")])])])]),t._v(" "),a("li",[a("p",[t._v("压缩")]),t._v(" "),a("blockquote",[a("p",[t._v("Syntax: gzip no | off;")]),t._v(" "),a("p",[t._v("default: gzip off;")]),t._v(" "),a("p",[t._v("Context: http,server,location,if in location")]),t._v(" "),a("p",[t._v("作用： 压缩传输")])])]),t._v(" "),a("li",[a("p",[t._v("压缩")]),t._v(" "),a("blockquote",[a("p",[t._v("Syntax: gzip_comp_level level")]),t._v(" "),a("p",[t._v(";Default: gzip_comp_level 1;")]),t._v(" "),a("p",[t._v("Context: http, server, location")])])]),t._v(" "),a("li",[a("p",[t._v("扩展Nginx压缩模块")]),t._v(" "),a("p",[a("code",[t._v("http_gzip_static_module")]),t._v(" - 预读gzip")]),t._v(" "),a("p",[a("code",[t._v("http.gunzip-module")]),t._v(" 应用支持gunzip的压缩方式")])])]),t._v(" "),a("h4",{attrs:{id:"example-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-4"}},[t._v("#")]),t._v(" Example")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置静态文件访问，同時配置预解压缩功能")]),t._v("\nlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("jpg"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("gif"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果需要访问压缩包，需要解压缩,解除注释")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_http_version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_comp_level "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_types text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("javascript text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("css applicati text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("httpd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("php image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jpeg image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gif image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n       root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("images"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置txt文本以及xml文件访问，配置本地解压缩")]),t._v("\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("txt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("xml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_http_version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_comp_level "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token macro property"}},[a("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("gzip")]),a("span",{pre:!0,attrs:{class:"token expression"}},[t._v("_types text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("piain application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("javascript text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("css applicati on"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("xml text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("javascript application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("httpd"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("php image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jpeg image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("gif image"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("png"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")])])]),t._v("\n       root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("docs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 配置下載功能")]),t._v("\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("download "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 需要开启了该功能，那么他会在磁盘内保留一份压缩文件，然后下载时就不需要临时解压，而是直接使用原文件      ")]),t._v("\n       gzip_static on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       tcp_nopush on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n       root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[a("strong",[t._v("Linux压缩功能")])])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 压缩某个文件,要想在nginx中预览压缩包，需要开启解压缩功能")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("gzip")]),t._v(" filePath\n")])])]),a("h3",{attrs:{id:"浏览器缓存服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存服务"}},[t._v("#")]),t._v(" 浏览器缓存服务")]),t._v(" "),a("ul",[a("li",[t._v("HTTP")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("服务器一般通过cache-control、Expires等控制浏览器的缓存行为")])])]),t._v(" "),a("ul",[a("li",[t._v("浏览器检查缓存机制")])]),t._v(" "),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" LR\n\n\tstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[浏览器请求]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("有缓存")]),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v("效验过期\n\t效验过期"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v("呈现 \n")])])]),a("ul",[a("li",[t._v("校验是否缓存是否过期\n"),a("ul",[a("li",[t._v("Expires"),a("code",[t._v("(HTTP)")])]),t._v(" "),a("li",[t._v("cache-control"),a("code",[t._v("(maxAge)")])]),t._v(" "),a("li",[t._v("Etag")]),t._v(" "),a("li",[t._v("Last--Modified")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"G:%5Cimages%5CHTTP%E8%AF%B7%E6%B1%82.png",alt:"avatar"}})]),t._v(" "),a("h4",{attrs:{id:"缓存头配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存头配置"}},[t._v("#")]),t._v(" 缓存头配置")]),t._v(" "),a("ul",[a("li",[t._v("expires")]),t._v(" "),a("li",[t._v("cache-control")])]),t._v(" "),a("h5",{attrs:{id:"example-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-5"}},[t._v("#")]),t._v(" Example")]),t._v(" "),a("ul",[a("li",[t._v("开启了expires")])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// html中设置Expires过期时间")]),t._v("\nlocation "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\\"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("r\n      expires "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v("h"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      root "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("opt"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("ul",[a("li",[t._v("此时cache-control就增加了一个max-age字段，其值就为秒数，设置的过期时间")])]),t._v(" "),a("div",{staticClass:"language-Cache-Control: extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("max-age=86400\n")])])]),a("h4",{attrs:{id:"跨站访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨站访问"}},[t._v("#")]),t._v(" 跨站访问")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("CSRF")]),t._v(" "),a("ul",[a("li",[t._v("跨站攻击")])]),t._v(" "),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" TD\nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("浏览器被控制向A网站发送请求")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v("网站A\n网站A"),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("接收响应,遭受攻击")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v(" start"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),t._v("\nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("用戶访问了B网站,并接收了他的文件")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v("黑客控制的网站B\n黑客控制的网站B "),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("黑客通过脚本操作客户端浏览器向A网站发起请求")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v(" start"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),t._v("\n")])])]),a("ul",[a("li",[t._v("其实跨站访问容易造成攻击，但是出于需求，但是配置CORS是Nginx的基本")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Nginx配置CORS")])]),t._v(" "),a("ul",[a("li",[t._v("其实也是通过添加header来开启CORS")])]),t._v(" "),a("blockquote",[a("p",[t._v("Syntax: add_header name value [always];")]),t._v(" "),a("p",[t._v("Default:Context:http, server, location, if in locationAccess-")]),t._v(" "),a("p",[t._v("Control-Allow-Origin")])])]),t._v(" "),a("li",[a("p",[t._v("Example")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 首先准备一个ajax跨域的请求，这里使用jQuery进行请求")]),t._v("\n$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ajax")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("''")]),t._v("，\n    type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token char"}},[t._v("'get'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    success"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),a("li",[a("p",[t._v("配置")]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code")])])])]),t._v(" "),a("p",[t._v("location ~ .*.(htm|html)$ {\ntadd_header Access-Control-Allow-0rigin [域名];\nadd_header Access-Control-Allow-Methods GET, POST, PUT, DELETE, OPTIONS;\nroot /opt/app/code;\n}")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("\n### 防盗链\n\n- 基于http_refer防盗链配置模块\n\n- ```c\n Syntax: valid referers none | blocked | server_names string. Default:Context:seryer, location\n ```\n\n- Example\n\n```c\n// 判断是否是当前的ip\nvalid_referers none blocked 192.168.43.242;\n# 如果不是则直接403\nif ($invalid_referer) {\n return 403;\n}\nroot /opt/app/images;\n")])])]),a("ul",[a("li",[t._v("当然这种方式对于防盗链比较简单")]),t._v(" "),a("li",[t._v("也可以使用正则的方式对防盗链进行辨别，防止将搜索引擎屏蔽")])]),t._v(" "),a("h2",{attrs:{id:"代理服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理服务器"}},[t._v("#")]),t._v(" 代理服务器")]),t._v(" "),a("h4",{attrs:{id:"代理的概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理的概念"}},[t._v("#")]),t._v(" 代理的概念")]),t._v(" "),a("ul",[a("li",[t._v("使用Nginx实现的代理\n"),a("ul",[a("li",[t._v("支持多种协议")])])])]),t._v(" "),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" LR\nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("HTTP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v(" Nginx服务器   \nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("ICMP/POP/IMAP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v(" Nginx服务器   \nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("HTTPS")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v(" Nginx服务器  \nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("RTMP")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v(" Nginx服务器   \nNginx服务器"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--")]),t._v(" HTTP-Server "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" 服务器\nNginx服务器"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--")]),t._v(" Mail-Server "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" 服务器\nNginx服务器"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--")]),t._v(" HTTP-Server "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" 服务器\nNginx服务器"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--")]),t._v(" Media-Server "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),t._v(" 服务器\n")])])]),a("h3",{attrs:{id:"正向代理和反向代理-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正向代理和反向代理-2"}},[t._v("#")]),t._v(" 正向代理和反向代理")]),t._v(" "),a("ul",[a("li",[t._v("正向代理")])]),t._v(" "),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" TB\nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("请求数据")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v("代理\n代理"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|返回得到的响应数据|")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),t._v("\n代理"),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("-.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("代理向服务器请求")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v(".->")])]),t._v("服务端\n服务端"),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("-.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("响应代理请求")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v(".->")])]),t._v("代理\n\n")])])]),a("ul",[a("li",[t._v("反向代理")])]),t._v(" "),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" TB\nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("请求数据")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v("代理\n代理"),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("-.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("代理转发请求")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v(".->")])]),t._v("服务端\n服务端"),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("-.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("响应数据请求")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v(".->")])]),t._v("代理\n代理"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|响应数据|")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),t._v("\n")])])]),a("h3",{attrs:{id:"代理配置详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理配置详解"}},[t._v("#")]),t._v(" 代理配置详解")]),t._v(" "),a("blockquote",[a("p",[t._v("Syntax: proxy_pass URL;")]),t._v(" "),a("p",[t._v("Default:Context:location, if in location, limit_except")])]),t._v(" "),a("ul",[a("li",[t._v("支持HTTP、HTTPS的方式")])]),t._v(" "),a("h4",{attrs:{id:"default"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#default"}},[t._v("#")]),t._v(" Default")]),t._v(" "),a("blockquote",[a("p",[t._v("准备两个虚拟服务器，一个为80号端口，一个为8080端口，即两个defualt文件，分别监听不同的端口")]),t._v(" "),a("p",[t._v("一个服务器向另一台服务器发送请求（端口跨域），此时请求失败")]),t._v(" "),a("p",[t._v("在请求的服务器中使用代理请求")]),t._v(" "),a("p",[t._v("location /proxy_test.html {")]),t._v(" "),a("ul",[a("li",[t._v("proxy_pass http:127.0.0.1:8089/admin.html;")])]),t._v(" "),a("p",[t._v("}")])]),t._v(" "),a("ul",[a("li",[t._v("如何配置反向代理")])]),t._v(" "),a("div",{staticClass:"language-mermaid extra-class"},[a("pre",{pre:!0,attrs:{class:"language-mermaid"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("graph")]),t._v(" TB\nstart"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("--")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("请求数据")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")])]),t._v("代理\n代理"),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("-.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("配置proxy代理转发请求")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v(".->")])]),t._v("只允许代理服务器请求服务器\n只允许代理服务器请求服务器"),a("span",{pre:!0,attrs:{class:"token inter-arrow-label"}},[a("span",{pre:!0,attrs:{class:"token arrow-head arrow operator"}},[t._v("-.")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("响应数据请求")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v(".->")])]),t._v("代理\n代理"),a("span",{pre:!0,attrs:{class:"token arrow operator"}},[t._v("--\x3e")]),a("span",{pre:!0,attrs:{class:"token label property"}},[t._v("|响应数据|")]),t._v("start"),a("span",{pre:!0,attrs:{class:"token text string"}},[t._v("[客户端]")]),t._v("\n")])])]),a("ul",[a("li",[t._v("其他配置语法-缓冲区")])]),t._v(" "),a("blockquote",[a("p",[t._v("Syntax: proxy_buffering on off;")]),t._v(" "),a("p",[t._v("Default: proxy_buffering on;")]),t._v(" "),a("p",[t._v("Context:http, server, location")]),t._v(" "),a("ul",[a("li",[t._v("扩展")]),t._v(" "),a("li",[t._v("proxy_buffer-size")]),t._v(" "),a("li",[t._v("proxy_buffers")]),t._v(" "),a("li",[t._v("proxy_busy_buffers_size")])])]),t._v(" "),a("ul",[a("li",[t._v("跳转重定向")])]),t._v(" "),a("blockquote",[a("p",[t._v("Syntax: proxy_redirect")]),t._v(" "),a("p",[t._v("default;oroxy_redirect offi;")]),t._v(" "),a("p",[t._v("proxy_redirect redirect replacement;")]),t._v(" "),a("p",[t._v("Default: proxy_redirect default;")]),t._v(" "),a("p",[t._v("Context:http, server, location")])]),t._v(" "),a("ul",[a("li",[t._v("头信息\n"),a("ul",[a("li",[t._v("如果在代理服务器中进行访问，那么HTTP中信息将是不准确的")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("Syntax: proxy_set_header field value;")]),t._v(" "),a("p",[t._v("Default: proxy_set_header Host $proxy_host;")]),t._v(" "),a("p",[t._v("proxy_set_header Connection close; Context:http, server, location")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("扩展:")]),t._v(" "),a("ul",[a("li",[t._v("proxy-hide-header")]),t._v(" "),a("li",[t._v("proxy_set_body")])])]),t._v(" "),a("li",[a("p",[t._v("超时")])])]),t._v(" "),a("blockquote",[a("p",[t._v("Syntax: proxy_connect_timeout time;")]),t._v(" "),a("p",[t._v("Default: proxy_connect timeout 60s;")]),t._v(" "),a("p",[t._v("Context:http, server, location")])]),t._v(" "),a("ul",[a("li",[t._v("扩展\n"),a("ul",[a("li",[t._v("proxy_read_timeout")]),t._v(" "),a("li",[t._v("proxy_send_timeout")])])])]),t._v(" "),a("h4",{attrs:{id:"example-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-6"}},[t._v("#")]),t._v(" EXample")]),t._v(" "),a("ul",[a("li",[t._v("一个典型的代理服务器")])]),t._v(" "),a("div",{staticClass:"language-c extra-class"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[t._v("location "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 代理地址")]),t._v("\n    proxy_pass http"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//127.0.0.1:8080;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用默认的重定向值")]),t._v("\n    proxy_redifect "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 向后端发送http主机名")]),t._v("\n    proxy_set_header Host $http_host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用真正请求端的IP地址")]),t._v("\n    proxy_set_header x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("IP $remote_addr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 超时时间 30s")]),t._v("\n    proxy_connect_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_send_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    poxy_read_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用缓存区的大小")]),t._v("\n    proxy_buffer_size "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打开之后，他会尽量去等待后端在缓冲区，减少IO")]),t._v("\n    proxy_buffering on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 临时文件大小，nginx的临时文件存放地址，var/cache/nginx/proxy_temp")]),t._v("\n    proxy_buffers "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_busy_buffers_size "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_max_temp_file_size "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"nginx代理服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx代理服务"}},[t._v("#")]),t._v(" Nginx代理服务")]),t._v(" "),a("h2",{attrs:{id:"负载均衡调度slb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡调度slb"}},[t._v("#")]),t._v(" 负载均衡调度SLB")]),t._v(" "),a("h2",{attrs:{id:"动态缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态缓存"}},[t._v("#")]),t._v(" 动态缓存")])])}),[],!1,null,null,null);a.default=r.exports}}]);